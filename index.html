<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welfare First — EROAD Customer Onboarding Process</title>
    
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        
        .node-card {
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            min-width: 220px;
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 3px solid;
            font-size: 15px;
        }
        
        .node-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }
        
        .node-card.selected {
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.4);
            z-index: 101;
        }
        
        .node-card.audit-critical {
            border-color: #ef4444 !important;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%) !important;
            animation: pulse-critical 2s ease-in-out infinite;
        }
        
        .node-card.audit-high {
            border-color: #f59e0b !important;
            background: linear-gradient(135deg, #fffbeb 0%, #fed7aa 100%) !important;
        }
        
        @keyframes pulse-critical {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
        }
        
        .edge-line { stroke: #cbd5e1; stroke-width: 3; fill: none; }
        .edge-arrow { fill: #cbd5e1; }
        
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const NODES = [
            { id: 'cognitoForm', title: 'Cognito Onboarding Form', category: 'Account/Setup', x: 50, y: 120, owner: 'EROAD Sales', severity: 'MEDIUM', manual: true,
              context: 'EROAD sends customer a Cognito form to collect vehicle registrations, locations, and escalation contacts',
              inputs: ['Customer details', 'Vehicle regos', 'Locations'], downstream: ['MyEROAD account', 'User uploads'],
              gaps: ['No timezone field', 'No WF group'], workarounds: ['Manual follow-up'], ideal: ['Make timezone required'] },
            { id: 'myeroadAccount', title: 'MyEROAD Account', category: 'Account/Setup', x: 50, y: 270, owner: 'EROAD Sales', severity: 'MEDIUM', manual: true,
              context: 'Sales creates MyEROAD account and sends credentials', inputs: ['Cognito data'], downstream: ['API key'],
              gaps: ['No standardized handoff', 'Email security risk'], workarounds: ['Manual email'], ideal: ['Automated provisioning'] },
            { id: 'apiKeyGeneration', title: 'API Key Generation', category: 'Account/Setup', x: 50, y: 420, owner: 'EROAD Sales Ops', severity: 'MEDIUM', manual: true,
              context: 'Generate partner API key via secure vault (24h expiry)', inputs: ['MyEROAD account'], downstream: ['API integration'],
              gaps: ['24h expiry', 'Key type confusion'], workarounds: ['Request resend'], ideal: ['Extended validity'] },
            { id: 'enterpriseCreation', title: 'WF Enterprise Creation', category: 'Account/Setup', x: 350, y: 120, owner: 'WF Admin (Sai)', severity: 'MEDIUM', manual: true,
              context: 'Create WF enterprise (one per customer, ties to API key)', inputs: ['Customer name', 'API key'], downstream: ['Organizations'],
              gaps: ['Manual Gethome-safe steps'], workarounds: ['Manual coordination'], ideal: ['Self-service creation'] },
            { id: 'apiKeyIntegration', title: 'API Key Integration', category: 'Data & Integration', x: 350, y: 420, owner: 'WF Admin (Sai)', severity: 'LOW', manual: true,
              context: 'Add API key in WF, enable driver sync, validate', inputs: ['Partner API key'], downstream: ['Group selection'],
              gaps: ['Malformed keys', 'No validation'], workarounds: ['Regenerate'], ideal: ['Auto validation'] },
            { id: 'groupSelection', title: 'Fleet Group Selection', category: 'Data & Integration', x: 650, y: 420, owner: 'WF Onboarding (Sai)', severity: 'MEDIUM', manual: true,
              context: 'Select correct groups - wrong group = missing vehicles', inputs: ['API connection', 'Groups'], downstream: ['Vehicle mapping'],
              gaps: ['Wrong group = missing vehicles'], workarounds: ['Manual verification'], ideal: ['Preflight % check'] },
            { id: 'orgCreation', title: 'Organization Creation', category: 'Account/Setup', x: 650, y: 120, owner: 'WF Admin', severity: 'MEDIUM', manual: true,
              context: 'Create orgs with contact, URL, timezone', inputs: ['Enterprise', 'Cognito data'], downstream: ['Teams'],
              gaps: ['Timezone mismatches'], workarounds: ['Manual entry'], ideal: ['Auto-suggest from Cognito'] },
            { id: 'teamCreation', title: 'Team Creation', category: 'Account/Setup', x: 950, y: 120, owner: 'WF Admin', severity: 'LOW', manual: true,
              context: 'Create teams for locations/branches', inputs: ['Organization', 'Locations'], downstream: ['Users'],
              gaps: ['Manual process'], workarounds: ['One by one'], ideal: ['Bulk creation'] },
            { id: 'userBulkUpload', title: 'User Bulk Upload', category: 'Account/Setup', x: 950, y: 270, owner: 'WF Admin', severity: 'HIGH', manual: true,
              context: 'Bulk upload via CSV (max 100) - email verification bottleneck', inputs: ['Contacts', 'CSV'], downstream: ['Team leaders'],
              gaps: ['Email spam', 'No SSO', '100 limit'], workarounds: ['Dummy emails', 'Tony\'s bot'], ideal: ['SSO provisioning'] },
            { id: 'teamLeaderAssignment', title: 'Team Leader Assignment', category: 'Account/Setup', x: 950, y: 420, owner: 'WF Admin', severity: 'MEDIUM', manual: true,
              context: 'Assign leaders via UI - no priority field', inputs: ['Users', 'Teams'], downstream: ['Escalation'],
              gaps: ['No ordering field'], workarounds: ['Name suffixes'], ideal: ['Explicit priority'] },
            { id: 'vehicleUserMapping', title: 'Vehicle→User Mapping', category: 'Data & Integration', x: 1250, y: 270, owner: 'WF Admin', severity: 'HIGH', manual: true,
              context: 'CRITICAL: Unmapped vehicles won\'t appear as alerts', inputs: ['Vehicle list', 'Users'], downstream: ['Alerts'],
              gaps: ['Manual per vehicle', 'Error-prone'], workarounds: ['Manual assignment'], ideal: ['Bulk mapping'] },
            { id: 'callCenterEnable', title: 'Call Center Enable', category: 'Ops/Monitoring', x: 50, y: 650, owner: 'Gethome-safe + WF', severity: 'MEDIUM', manual: true,
              context: 'Gethome-safe must enable - Sai cannot', inputs: ['Enterprise setup'], downstream: ['Monitoring'],
              gaps: ['Team dependency'], workarounds: ['Manual request'], ideal: ['Auto-enable'] },
            { id: 'monitoringWorkflow', title: 'Monitoring Workflow', category: 'Ops/Monitoring', x: 350, y: 650, owner: 'Call Center Ops', severity: 'MEDIUM', manual: true,
              context: 'Operators follow SOP - many skip marking Done', inputs: ['Alerts', 'SOP'], downstream: ['PDF upload'],
              gaps: ['Skip Done', 'No forced completion'], workarounds: ['Manual checklist'], ideal: ['Embedded SOP'] },
            { id: 'activityPdfUpload', title: 'Activity PDF Upload', category: 'Ops/Monitoring', x: 650, y: 650, owner: 'Call Center Ops', severity: 'MEDIUM', manual: true,
              context: 'Save as PDF (Ctrl+P), upload, add notes', inputs: ['Activity details'], downstream: ['Records'],
              gaps: ['Manual PDF save/upload'], workarounds: ['Ctrl+P'], ideal: ['Auto-generate PDF'] },
            { id: 'monitoringActivation', title: '⚠️ Monitoring Activation', category: 'Ops/Monitoring', x: 950, y: 650, owner: 'EROAD + WF', severity: 'CRITICAL', manual: true,
              context: 'CRITICAL: Customer controls ON/OFF - WF has ZERO visibility', inputs: ['Customer decision'], downstream: ['Billing'],
              gaps: ['NO API/webhook', 'NO timestamp', 'Billing misalignment'], workarounds: ['None - complete gap'], ideal: ['EROAD webhook'] },
            { id: 'offboardingProcess', title: '⚠️ Offboarding', category: 'Ops/Monitoring', x: 1250, y: 650, owner: 'WF + EROAD', severity: 'CRITICAL', manual: true,
              context: 'CRITICAL: Manual email - EROAD not notified, continues billing', inputs: ['Offboard request'], downstream: ['Billing'],
              gaps: ['Manual email', 'EROAD not notified', 'Billing disputes'], workarounds: ['Manual emails'], ideal: ['Auto notification'] },
            { id: 'credentialsManagement', title: 'Credentials Management', category: 'Automation/Tools', x: 50, y: 900, owner: 'WF / InfoSec', severity: 'HIGH', manual: true,
              context: 'Credentials in Teams doc - security risk', inputs: ['Credentials'], downstream: ['Operations'],
              gaps: ['Teams doc', 'Security risk'], workarounds: ['Teams doc'], ideal: ['Secrets manager'] },
            { id: 'excelTracking', title: 'Excel Tracker', category: 'Automation/Tools', x: 350, y: 900, owner: 'WF Product', severity: 'MEDIUM', manual: true,
              context: 'Manual Excel tracker - no live updates', inputs: ['Onboarding steps'], downstream: ['Progress'],
              gaps: ['Manual', 'Out of sync'], workarounds: ['Manual updates'], ideal: ['Live dashboard'] },
            { id: 'verificationBot', title: 'Verification Bot', category: 'Automation/Tools', x: 650, y: 900, owner: 'Engineering (Tony)', severity: 'LOW', manual: false,
              context: 'Tony\'s bot auto-confirms emails', inputs: ['Verification emails'], downstream: ['User activation'],
              gaps: ['Not fully deployed'], workarounds: ['Manual clicks'], ideal: ['Fully automated'] },
            { id: 'browserExtension', title: 'Browser Extension', category: 'Automation/Tools', x: 950, y: 900, owner: 'Engineering / InfoSec', severity: 'LOW', manual: false,
              context: 'Portal switching extension - awaiting approval', inputs: ['Portal URLs'], downstream: ['Faster workflow'],
              gaps: ['Awaiting approval'], workarounds: ['Manual login'], ideal: ['Approved'] },
            { id: 'preflightChecks', title: 'Preflight Checks', category: 'Automation/Tools', x: 1250, y: 900, owner: 'Engineering', severity: 'LOW', manual: false,
              context: 'Automated validation - prevents errors', inputs: ['API key', 'Groups'], downstream: ['Quality'],
              gaps: ['Not implemented'], workarounds: ['Manual testing'], ideal: ['Full validation'] }
        ];

        const EDGES = [
            { from: 'cognitoForm', to: 'myeroadAccount' }, { from: 'cognitoForm', to: 'orgCreation' }, { from: 'cognitoForm', to: 'userBulkUpload' },
            { from: 'myeroadAccount', to: 'apiKeyGeneration' }, { from: 'apiKeyGeneration', to: 'apiKeyIntegration' },
            { from: 'enterpriseCreation', to: 'apiKeyIntegration' }, { from: 'apiKeyIntegration', to: 'groupSelection' },
            { from: 'groupSelection', to: 'vehicleUserMapping' }, { from: 'enterpriseCreation', to: 'orgCreation' },
            { from: 'orgCreation', to: 'teamCreation' }, { from: 'teamCreation', to: 'userBulkUpload' },
            { from: 'userBulkUpload', to: 'teamLeaderAssignment' }, { from: 'userBulkUpload', to: 'vehicleUserMapping' },
            { from: 'vehicleUserMapping', to: 'monitoringWorkflow' }, { from: 'enterpriseCreation', to: 'callCenterEnable' },
            { from: 'callCenterEnable', to: 'monitoringWorkflow' }, { from: 'monitoringWorkflow', to: 'activityPdfUpload' },
            { from: 'myeroadAccount', to: 'monitoringActivation' }, { from: 'monitoringActivation', to: 'monitoringWorkflow' },
            { from: 'monitoringWorkflow', to: 'offboardingProcess' }, { from: 'apiKeyGeneration', to: 'credentialsManagement' },
            { from: 'credentialsManagement', to: 'browserExtension' }, { from: 'userBulkUpload', to: 'verificationBot' },
            { from: 'apiKeyIntegration', to: 'preflightChecks' }, { from: 'enterpriseCreation', to: 'excelTracking' }
        ];

        const COLORS = { 'Account/Setup': '#3b82f6', 'Data & Integration': '#8b5cf6', 'Ops/Monitoring': '#10b981', 'Automation/Tools': '#f59e0b' };

        function App() {
            const [selected, setSelected] = useState(null);
            const [search, setSearch] = useState('');
            const [audit, setAudit] = useState(false);
            const [ideal, setIdeal] = useState(false);
            const [zoom, setZoom] = useState(0.65);
            const [pan, setPan] = useState({ x: 50, y: 50 });
            const [dragging, setDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });

            const filtered = NODES.filter(n => !search || n.title.toLowerCase().includes(search.toLowerCase()) || n.owner.toLowerCase().includes(search.toLowerCase()));

            return (
                <div className="flex flex-col h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500">
                    <div className="no-print bg-white shadow-2xl p-4 z-50">
                        <div className="flex items-center justify-between gap-4 flex-wrap">
                            <h1 className="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                WF — EROAD Onboarding
                            </h1>
                            <input type="text" placeholder="🔍 Search..." value={search} onChange={(e) => setSearch(e.target.value)}
                                className="px-4 py-2.5 border-2 rounded-xl focus:border-indigo-500 outline-none w-80" />
                            <div className="flex gap-2 flex-wrap">
                                <button onClick={() => setAudit(!audit)}
                                    className={`px-5 py-2.5 rounded-xl font-bold ${audit ? 'bg-amber-500 text-white' : 'bg-gray-100'}`}>
                                    🔍 Audit
                                </button>
                                <button onClick={() => setIdeal(!ideal)}
                                    className={`px-5 py-2.5 rounded-xl font-bold ${ideal ? 'bg-green-500 text-white' : 'bg-gray-100'}`}>
                                    💡 Ideal
                                </button>
                                <button onClick={() => { const n = NODES.find(n => n.severity === 'CRITICAL'); setSelected(n); }}
                                    className="px-5 py-2.5 bg-red-500 text-white rounded-xl font-bold">🚨 Gap</button>
                                <button onClick={() => { setZoom(0.65); setPan({ x: 50, y: 50 }); }}
                                    className="px-5 py-2.5 bg-indigo-500 text-white rounded-xl font-bold">⛶ Fit</button>
                                <button onClick={() => setZoom(z => Math.min(2, z * 1.2))} className="px-4 py-2.5 bg-gray-700 text-white rounded-xl font-bold text-xl">+</button>
                                <button onClick={() => setZoom(z => Math.max(0.3, z * 0.8))} className="px-4 py-2.5 bg-gray-700 text-white rounded-xl font-bold text-xl">−</button>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 relative overflow-hidden cursor-grab"
                        onMouseDown={(e) => { setDragging(true); setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y }); }}
                        onMouseMove={(e) => { if (dragging) setPan({ x: e.clientX - dragStart.x, y: e.clientY - dragStart.y }); }}
                        onMouseUp={() => setDragging(false)}
                        onMouseLeave={() => setDragging(false)}
                        onWheel={(e) => { e.preventDefault(); setZoom(z => Math.min(Math.max(0.3, z + e.deltaY * -0.001), 2)); }}>
                        <svg className="w-full h-full" style={{ background: 'white' }}>
                            <g transform={`translate(${pan.x}, ${pan.y}) scale(${zoom})`}>
                                <rect x="0" y="0" width="1600" height="550" fill="#eff6ff" opacity="0.3" rx="20" />
                                <text x="30" y="60" fontSize="32" fontWeight="900" fill="#3b82f6">Account / Setup</text>
                                
                                <rect x="0" y="570" width="1600" height="300" fill="#f5f3ff" opacity="0.3" rx="20" />
                                <text x="30" y="630" fontSize="32" fontWeight="900" fill="#8b5cf6">Data & Integration</text>
                                
                                <rect x="0" y="890" width="1600" height="300" fill="#f0fdf4" opacity="0.3" rx="20" />
                                <text x="30" y="950" fontSize="32" fontWeight="900" fill="#10b981">Ops / Monitoring</text>
                                
                                <rect x="0" y="1210" width="1600" height="250" fill="#fffbeb" opacity="0.3" rx="20" />
                                <text x="30" y="1270" fontSize="32" fontWeight="900" fill="#f59e0b">Automation / Tools</text>

                                {EDGES.map((e, i) => {
                                    const from = NODES.find(n => n.id === e.from);
                                    const to = NODES.find(n => n.id === e.to);
                                    if (!from || !to) return null;
                                    return <line key={i} className="edge-line" x1={from.x + 110} y1={from.y + 50} x2={to.x + 110} y2={to.y + 50} />;
                                })}

                                {filtered.map(node => {
                                    let cls = 'node-card';
                                    if (selected?.id === node.id) cls += ' selected';
                                    if (audit && node.severity === 'CRITICAL') cls += ' audit-critical';
                                    else if (audit && node.severity === 'HIGH') cls += ' audit-high';
                                    
                                    return (
                                        <foreignObject key={node.id} x={node.x} y={node.y} width="220" height="120" onClick={() => setSelected(node)}>
                                            <div className={cls} style={{ borderColor: COLORS[node.category] }}>
                                                <div className="flex items-start justify-between mb-2">
                                                    <div className="font-bold text-gray-900 flex-1 pr-2" style={{ fontSize: '15px' }}>{node.title}</div>
                                                    <span className={`px-2 py-1 rounded-lg text-xs font-bold ${node.manual ? 'bg-orange-100 text-orange-700' : 'bg-green-100 text-green-700'}`}>
                                                        {node.manual ? 'MANUAL' : 'AUTO'}
                                                    </span>
                                                </div>
                                                <div className="text-xs text-gray-600 font-medium mb-2">{node.owner}</div>
                                                {node.severity === 'CRITICAL' && <div className="mt-2 px-2 py-1 bg-red-600 text-white text-xs font-black rounded-md">🚨 CRITICAL</div>}
                                                {node.severity === 'HIGH' && <div className="mt-2 px-2 py-1 bg-orange-500 text-white text-xs font-bold rounded-md">⚠️ HIGH</div>}
                                            </div>
                                        </foreignObject>
                                    );
                                })}
                            </g>
                        </svg>

                        <div className="no-print absolute bottom-6 left-6 bg-white rounded-2xl shadow-2xl p-5">
                            <h3 className="font-black text-lg mb-3">📊 Categories</h3>
                            {Object.entries(COLORS).map(([cat, color]) => (
                                <div key={cat} className="flex items-center gap-3 mb-2">
                                    <div className="w-6 h-6 rounded-lg" style={{ background: color }}></div>
                                    <span className="font-semibold text-sm">{cat}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {selected && (
                        <div className="no-print fixed right-0 top-0 bottom-0 w-[500px] bg-white shadow-2xl overflow-y-auto z-50">
                            <div className="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6">
                                <button onClick={() => setSelected(null)} className="absolute top-6 right-6 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-2xl font-bold">×</button>
                                <h2 className="text-2xl font-black mb-3 pr-12">{selected.title}</h2>
                                <div className="flex gap-2"><span className="px-3 py-1.5 rounded-lg text-sm font-bold bg-white/20">{selected.severity}</span></div>
                            </div>
                            <div className="p-6 space-y-6">
                                <div><h3 className="text-xs font-black uppercase text-gray-500 mb-2">👤 Owner</h3><p className="text-base font-semibold">{selected.owner}</p></div>
                                <div><h3 className="text-xs font-black uppercase text-gray-500 mb-2">ℹ️ Context</h3><p className="text-base">{selected.context}</p></div>
                                <div><h3 className="text-xs font-black uppercase text-gray-500 mb-2">📥 Inputs</h3><ul>{selected.inputs.map((i, idx) => <li key={idx} className="text-base">→ {i}</li>)}</ul></div>
                                <div><h3 className="text-xs font-black uppercase text-gray-500 mb-2">📤 Downstream</h3><ul>{selected.downstream.map((d, idx) => <li key={idx} className="text-base">⇒ {d}</li>)}</ul></div>
                                {selected.gaps.length > 0 && <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg"><h3 className="text-sm font-black text-red-900 mb-2">⚠️ GAPS</h3><ul>{selected.gaps.map((g, idx) => <li key={idx} className="text-sm text-red-800">• {g}</li>)}</ul></div>}
                                {selected.workarounds.length > 0 && <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg"><h3 className="text-sm font-black text-yellow-900 mb-2">🔧 WORKAROUNDS</h3><ul>{selected.workarounds.map((w, idx) => <li key={idx} className="text-sm text-yellow-800">• {w}</li>)}</ul></div>}
                                {ideal && selected.ideal.length > 0 && <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg"><h3 className="text-sm font-black text-green-900 mb-2">💡 IDEAL</h3><ul>{selected.ideal.map((i, idx) => <li key={idx} className="text-sm text-green-800">• {i}</li>)}</ul></div>}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
