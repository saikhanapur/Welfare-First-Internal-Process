<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Welfare First — Interactive Onboarding Flowchart</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#06b6d4;--text:#e6eef6}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#071029 0%, #071827 60%);color:var(--text)}
    .app{display:grid;grid-template-columns:1fr 360px;gap:18px;height:100vh;padding:18px}
    .canvas{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 30px rgba(2,6,23,.6)}
    #cy{width:100%;height:100%;min-height:740px;border-radius:8px}
    .sidebar{background:rgba(255,255,255,0.03);border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:12px}
    .title{font-weight:700;font-size:18px;margin-bottom:6px}
    .details{flex:1;overflow:auto;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    .controls{display:flex;gap:8px}
    button{background:var(--accent);border:0;padding:8px 10px;border-radius:8px;color:#042027;font-weight:600;cursor:pointer}
    .btn-secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
    .node-title{font-weight:700;margin-bottom:6px}
    .node-text{font-size:13px;line-height:1.4;color:rgba(230,238,246,.9)}
    .legend{font-size:12px;color:rgba(230,238,246,.7);margin-top:8px}
    footer{position:fixed;left:18px;bottom:18px;color:rgba(230,238,246,.6);font-size:12px}
    .search{display:flex;gap:8px}
    input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:var(--text)}
    a.link{color:var(--accent);font-weight:600;text-decoration:none}
  </style>
  <!-- Cytoscape.js CDN -->
  <script src="https://unpkg.com/cytoscape@3.24.0/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/cytoscape-dagre@2.4.0/cytoscape-dagre.js"></script>
  <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
</head>
<body>
  <div class="app">
    <div class="canvas">
      <div id="cy"></div>
    </div>

    <div class="sidebar">
      <div>
        <div class="title">Welfare First — Onboarding Flow</div>
        <div style="font-size:13px;color:rgba(230,238,246,.7)">Click nodes to reveal details. Drag canvas to pan, scroll to zoom.</div>
      </div>

      <div class="controls">
        <button id="fitBtn">Fit</button>
        <button id="zoomIn">Zoom +</button>
        <button id="zoomOut">Zoom -</button>
        <button id="exportPng" class="btn-secondary">Export PNG</button>
      </div>

      <div class="search">
        <input id="searchInput" type="text" placeholder="Search node by title (e.g., 'API key')" />
        <button id="searchBtn" class="btn-secondary">Find</button>
      </div>

      <div class="details" id="details">
        <div class="node-title">Welcome</div>
        <div class="node-text">Click any node on the diagram to see the step details, checklist items, and links to runbook templates. Use the Export PNG button to snapshot the chart for documentation or presentations.</div>
        <div class="legend">Legend: Blue = Account / Setup, Green = Data & Mapping, Orange = Ops & Monitoring, Purple = Automation / Tools</div>
      </div>

      <div style="display:flex;gap:8px;justify-content:space-between">
        <a id="downloadHtml" class="link" href="#">Download HTML</a>
        <a class="link" href="https://github.com/">Open in GitHub</a>
      </div>
    </div>
  </div>

  <footer>Generated interactive onboarding flow — copy this file to GitHub Pages (single-file HTML)</footer>

  <script>
    // Define nodes and detailed content (based on Sai Kanapur transcript)
    const NODE_DETAILS = {
      'pre_onboarding':{
        title:'Pre-onboarding (Cognito form)',
        body:`EROAD sends the Cognito onboarding form. The form should include vehicle regos, locations, escalation contacts, and other onboarding data. Use this as canonical input for bulk uploads.`
      },
      'sales_actions':{
        title:'Sales actions',
        body:`Sales creates MyEROAD account (username + temp password) and generates the partner API key through the secure vault link. Save credentials in a secure vault; if the vault link expires, request resend.`
      },
      'enterprise_creation':{
        title:'Enterprise creation',
        body:`Create a new Welfare First enterprise for each customer (one enterprise per customer). Use Gethome-safe signup or request. Ensure Welfare First branding and central account settings are configured.`
      },
      'add_integration':{
        title:'Add API key & Integration',
        body:`Account → Configure → Integrations → add partner EROAD API key; enable driver sync. Validate API key length; if malformed, ask EROAD to regenerate.`
      },
      'fleet_mapping':{
        title:'Fleet mapping & groups',
        body:`Ask customer to create a 'Welfare First' group in MyEROAD or select correct groups. If vehicles missing, verify API key and group selection.`
      },
      'organizations':{
        title:'Create Organizations',
        body:`Create orgs under the enterprise, set primary contact, URL segment, and timezone. For multi-region customers, create multiple orgs to reflect timezone/escalation differences.`
      },
      'call_center_setup':{
        title:'Call center setup',
        body:`Get Gethome-safe to add the enterprise to the call center dashboard. Enable the org call center toggle once teams/users are configured. Don't enable early to avoid spurious alerts.`
      },
      'alert_settings':{
        title:'Alert notification settings',
        body:`Alert follow-up emails are disabled by default to avoid customer confusion; enable only on request. Escalation contacts are editable per org/team.`
      },
      'teams_users':{
        title:'Teams & Users',
        body:`Create teams first. Bulk-upload users (≤100 per batch) using onboarding data; use dummy emails + CC Sai to avoid spamming customers with verification emails. Assign users to teams and mark team leaders.`
      },
      'vehicle_mapping':{
        title:'Vehicle → User mapping',
        body:`Map vehicles to users at the account level (vehicle detail → assign user). This is critical — unmapped vehicles won't show alerts on the dashboard.`
      },
      'monitoring_ops':{
        title:'Monitoring & Operator workflow',
        body:`Operators view the call center dashboard, open events, click Start Follow Up, follow SOP steps and mark Done for each step. For collision/rollover/panic, read the event label first (no footage). Save activity PDFs and upload to the portal.`
      },
      'after_alerts':{
        title:'After-alert handling',
        body:`When actioned, save activity page as PDF, upload to portal, change status to 'reviewed'. Attach SOP or coaching documents as needed.`
      },
      'timezones':{
        title:'Timezones & edge cases',
        body:`Ensure org and vehicle timezones are set correctly to prevent miscommunication. Multi-timezone fleets may need per-vehicle timezone assignment.`
      },
      'credentials':{
        title:'Credentials & secrets',
        body:`Move credentials from Teams doc to a password vault (LastPass). Use standardized temporary admin emails (e.g., Sai.+customer@firstsecurity.co.nz) when creating accounts.`
      },
      'automation':{
        title:'Automation opportunities',
        body:`Implement a UI bot to auto-confirm verification emails for large bulk uploads. Consider a browser extension for quick portal switching (InfoSec approval required).`
      }
    };

    // cytoscape nodes & edges
    const elements = [
      { data: { id: 'pre_onboarding', label: 'Pre-onboarding' } },
      { data: { id: 'sales_actions', label: 'Sales actions' } },
      { data: { id: 'enterprise_creation', label: 'Enterprise
creation' } },
      { data: { id: 'add_integration', label: 'Add API Key
& Integration' } },
      { data: { id: 'fleet_mapping', label: 'Fleet Mapping
& Groups' } },
      { data: { id: 'organizations', label: 'Organizations' } },
      { data: { id: 'call_center_setup', label: 'Call Center
Setup' } },
      { data: { id: 'alert_settings', label: 'Alert
Settings' } },
      { data: { id: 'teams_users', label: 'Teams &
Users' } },
      { data: { id: 'vehicle_mapping', label: 'Vehicle →
User Mapping' } },
      { data: { id: 'monitoring_ops', label: 'Monitoring &
Operator Flow' } },
      { data: { id: 'after_alerts', label: 'After-Alert
Handling' } },
      { data: { id: 'timezones', label: 'Timezones' } },
      { data: { id: 'credentials', label: 'Credentials
& Secrets' } },
      { data: { id: 'automation', label: 'Automation
Opportunities' } },

      // edges
      { data: { source: 'pre_onboarding', target: 'sales_actions' } },
      { data: { source: 'sales_actions', target: 'enterprise_creation' } },
      { data: { source: 'enterprise_creation', target: 'add_integration' } },
      { data: { source: 'add_integration', target: 'fleet_mapping' } },
      { data: { source: 'fleet_mapping', target: 'organizations' } },
      { data: { source: 'organizations', target: 'teams_users' } },
      { data: { source: 'teams_users', target: 'vehicle_mapping' } },
      { data: { source: 'vehicle_mapping', target: 'monitoring_ops' } },
      { data: { source: 'monitoring_ops', target: 'after_alerts' } },
      { data: { source: 'organizations', target: 'call_center_setup' } },
      { data: { source: 'call_center_setup', target: 'monitoring_ops' } },
      { data: { source: 'add_integration', target: 'credentials' } },
      { data: { source: 'teams_users', target: 'automation' } },
      { data: { source: 'organizations', target: 'timezones' } }
    ];

    // init cytoscape
    const cy = cytoscape({
      container: document.getElementById('cy'),
      elements,
      style: [
        { selector: 'node', style: { 'label': 'data(label)', 'text-wrap':'wrap','text-valign':'center','text-halign':'center','background-color':'#0ea5a9','color':'#022627','width':'label','height':'label','padding':'14px','font-size':'12px','shape':'roundrectangle','text-margin-y':0 } },
        { selector: 'edge', style: { 'curve-style':'bezier','target-arrow-shape':'triangle','line-color':'rgba(255,255,255,0.08)','target-arrow-color':'rgba(255,255,255,0.08)','width':2 } },
        { selector: ':selected', style: { 'border-width':3,'border-color':'#ffd166' } }
      ],
      layout: { name: 'dagre', rankDir: 'LR', nodeSep: 40, rankSep: 80 }
    });

    // click handler to show details
    cy.on('tap', 'node', function(evt){
      const id = evt.target.id();
      const info = NODE_DETAILS[id];
      const detailsEl = document.getElementById('details');
      detailsEl.innerHTML = `<div class=\"node-title\">${info.title}</div><div class=\"node-text\">${info.body.replace(/\n/g,'<br/>')}</div>`;

      // zoom into node
      cy.animate({ center: { eles: evt.target }, zoom: { level: 1.4 }, duration: 300 });
    });

    // controls
    document.getElementById('fitBtn').addEventListener('click',()=>cy.fit());
    document.getElementById('zoomIn').addEventListener('click',()=>cy.zoom(cy.zoom()+0.2));
    document.getElementById('zoomOut').addEventListener('click',()=>cy.zoom(cy.zoom()-0.2));

    // export PNG
    document.getElementById('exportPng').addEventListener('click',()=>{
      const png64 = cy.png({full:true,scale:2});
      const a = document.createElement('a'); a.href = png64; a.download = 'welfare-first-onboarding.png'; a.click();
    });

    // search
    document.getElementById('searchBtn').addEventListener('click',()=>{
      const q = document.getElementById('searchInput').value.toLowerCase().trim();
      if(!q) return; const found = cy.nodes().filter(n=>n.data('label').toLowerCase().includes(q));
      if(found.length>0){ cy.elements().unselect(); found.select(); cy.animate({center:{eles:found},zoom:1.2,duration:300}); found.flash = setTimeout(()=>found.unselect(),1500); }
      else alert('No node found for: '+q);
    });

    // download this HTML file
    document.getElementById('downloadHtml').addEventListener('click',function(e){
      e.preventDefault();
      const html = `<!doctype html>\n${document.documentElement.outerHTML}`;
      const blob = new Blob([html],{type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'welfare-first-interactive-onboarding.html'; a.click(); URL.revokeObjectURL(url);
    });

    // initial fit
    cy.ready(()=>cy.fit());
  </script>
</body>
</html>
